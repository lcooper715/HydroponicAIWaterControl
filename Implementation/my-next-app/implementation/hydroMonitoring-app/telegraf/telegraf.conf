[agent]
  interval = "5s"
  flush_interval = "5s"
  hostname = "telegraf"

# Subscribe to MQTT
[[inputs.mqtt_consumer]]
  servers = ["tcp://mosquitto:1883"]
  topics  = ["sensors/water/+"]   # + matches deviceId
  qos = 0
  connection_timeout = "30s"
  data_format = "json_v2"

  [[inputs.mqtt_consumer.json_v2]]
    measurement_name = "water_quality"

    [[inputs.mqtt_consumer.json_v2.tag]]
      path = "device"
      rename = "device"

    [[inputs.mqtt_consumer.json_v2.field]]
      path = "ph"
      type = "float"

    [[inputs.mqtt_consumer.json_v2.field]]
      path = "orp"
      type = "float"

    [[inputs.mqtt_consumer.json_v2.field]]
      path = "temp"
      type = "float"

# Optional but recommended: densify rows (QuestDB likes denser rows)
[[aggregators.merge]]
  drop_original = true

# Write to QuestDB via ILP/HTTP on port 9000
# QuestDB docs show Telegraf writing via Influx Line Protocol over HTTP. :contentReference[oaicite:3]{index=3}
[[outputs.influxdb_v2]]
  urls = ["http://questdb:9000"]
  content_encoding = "identity"
